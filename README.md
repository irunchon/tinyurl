# tinyurl  
tinyurl - моя реализация сервиса по созданию сокращённых URL-адресов.  
## Описание    
Сервис генерирует для URL сокращённый адрес - хэш длиной в 10 символов. Хэш состоит из символов латинского алфавита в врехнем и нижнем регистре, цифр и символа "_" (подчёркивание).  
Доступ к API сервиса реализован по следующим протоколам:  
* HTTP (используется порт 8080)  
* GRPC (используется порт 50051)  

Предоставляется две опции для хранения данных (соответствие исходный URL и его хэш): напрямую в памяти или в БД Postgres. Выбор типа хранилища осуществляется через задание переменной окружения в файле .env:  
`STORAGE_TYPE=postgres` для использования БД  
`STORAGE_TYPE=inmemory` для использования памяти сервиса    

## Использование сервиса  
### HTTP  
Для получения сокращённого адреса (хэш) с помощью метода POST передаётся JSON, где для поля longUrl указывается значение - исходный URL-адрес.  
Пример использования:       
```
curl -X POST http://localhost:8080/v1/set_url -d '{"longUrl":"https://wikipedia.org"}'  
```
В ответ от сервиса также приходит JSON, где для поля shortUrl указано значение - хэш отправленного URL-адреса.  
Пример ответа сервиса:  
```
{"shortUrl":"POy87UlkbJ"}
```  
  
Для получения полного (исходного) URL-адреса по хэшу используется метод GET.  
```
curl -X GET http://localhost:8080/POy87UlkbJ
```  
В ответ от сервиса также приходит JSON, где для поля longUrl указано значение - исходный (полный) URL-адрес.    
Пример ответа сервиса:  
```
{"longUrl":"https://wikipedia.org"}  
```  
В случае успеха ответ приходит с кодом 301. Если запрошенный хэш имеет некорректный формат или не найден в базе, то в ответ будет отправлен код 400 или 404 соответственно.  

### Сборка сервиса    
Сервис может быть запущен в виде Docker-образа. В этом случае используется только inmemory хранилище.  
В случае использования БД до запуска сервиса нужно запустить соответствующий контейнер с postgres.    
Для удобства сборки и запуска docker и сервиса заданы соответствующие цели в Makefile.  

Сборка и запуск сервиса в виде docker:  
```bash
$ make docker-build  
$ make docker-run  
```  
Запуск docker с postgres:  
```bash
$ make compose-up  
``` 
Запуск сервиса без использования docker:  
```bash
$ make
```  
Запуск тестов:  
```bash
$ make test
```  
